# vim: ft=make ts=4 sw=4

# Config for building Whonix template using online repositories

GIT_BASEURL ?= https://github.com
GIT_PREFIX ?= QubesOS/qubes-
BRANCH ?= master

VERBOSE = 2

BACKEND_VMM=xen

DIST_DOM0 ?= fc25
DISTS_VM ?= whonix-gateway-15 \
			whonix-workstation-15

COMPONENTS ?= \
    linux-template-builder \
    linux-yum \
    template-whonix \
	builder \
	builder-rpm \
	builder-debian

GIT_URL_template_whonix = $(GIT_BASEURL)/Whonix/qubes-template-whonix.git
BRANCH_template_whonix = master

USE_QUBES_REPO_VERSION = 4.0

USE_QUBES_REPO_TESTING = 1

# override default version set in tb-updater package
#WHONIX_TBB_VERSION = 7.0.6

BUILDER_PLUGINS = builder-debian
BUILDER_PLUGINS += builder-rpm
BUILDER_PLUGINS += template-whonix
#BUILDER_PLUGINS += mgmt-salt

BRANCH_linux_template_builder = master
BRANCH_linux_yum = master
BRANCH_builder = master
BRANCH_builder_fedora = master
BRANCH_builder_debian = master
BRANCH_builder_archlinux = master
BRANCH_builder_github = master
BRANCH_builder_windows = master

TEMPLATE_LABEL ?=

TEMPLATE_LABEL += buster+whonix-gateway+minimal+no-recommends:whonix-gw-15
TEMPLATE_LABEL += buster+whonix-workstation+minimal+no-recommends:whonix-ws-15

TEMPLATE_ALIAS ?=

TEMPLATE_ALIAS += whonix-gateway-15:buster+whonix-gateway+minimal+no-recommends
TEMPLATE_ALIAS += whonix-workstation-15:buster+whonix-workstation+minimal+no-recommends

#TEMPLATE_FLAVOR_DIR :=
#TEMPLATE_FLAVOR_DIR += +gnome:$$SCRIPTSDIR/gnome
#TEMPLATE_FLAVOR_DIR += +flash:$$SCRIPTSDIR/flash
#TEMPLATE_FLAVOR_DIR += +desktop:$$SCRIPTSDIR/desktop

LINUX_REPO_BASEDIR ?= $(SRC_DIR)/linux-yum/r3.2

# Qubes-builder deps
DEPENDENCIES := git rpmdevtools rpm-build createrepo

# Additional for debian template
DEPENDENCIES += debootstrap dpkg-dev

VERBOSE=2

BUILDER_TURBO_MODE = 1
TERM = dumb

TEMPLATE_ROOT_WITH_PARTITIONS = 1

import-whonix-keys:
	if ! [ -d "$(KEYRING_DIR_GIT)" ]; then \
        export GNUPGHOME="$(KEYRING_DIR_GIT)"; \
		scripts/verify-git-tag; \
		echo "$(whonix_key)" | gpg --import || exit 1; \
		echo '916B8D99C38EAF5E8ADC7A2A8D66066A2EEACCDA:6:' | gpg --import-ownertrust; \
	fi

get-sources: import-whonix-keys

# pub   rsa4096 2014-01-16 [SC] [expires: 2021-04-17]
#      916B8D99C38EAF5E8ADC7A2A8D66066A2EEACCDA
#uid           Patrick Schleizer <adrelanos@riseup.net>
#sub   rsa4096 2014-01-16 [E] [expires: 2021-04-17]
#sub   rsa4096 2014-01-16 [A] [expires: 2021-04-17]
#sub   rsa4096 2014-01-16 [S] [expires: 2021-04-17]
#
# make interprets '-' and '+' at the start of the line specially, so rewrap
# lines to avoid it
define whonix_key
-----BEGIN PGP PUBLIC KEY BLOCK-----

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
=m5Sl
-----END PGP PUBLIC KEY BLOCK-----
endef

# vim: ft=make
